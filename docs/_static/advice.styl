
lightness_difference(color1, color2)
    l1 = lightness(color1)
    l2 = lightness(color2)
    return abs(l1 - l2)


invert_color_aspect(color, aspect)
    value = aspect(color)
    value = 50% - (value - 50%)
    return aspect(color, value)


invert_font_color(font_color)
    light = lightness(font_color)
    
    if light > 0.5
        light = 0.3
    else
        light = 0.7
    
    return lightness(font_color, light)


highest_lightness_difference(ref_color, color1, color2)
    r1 = lightness_difference(ref_color, color1)
    r2 = lightness_difference(ref_color, color2)
    if r1 > r2
        return color1
    else
        return color2


make_font_color_for_background(bg_color)
    fg_color = font_color_regular
    threshold = lightness_difference(font_color_regular, bg_color_regular)
    
    bg_light = lightness(bg_color)
    fg_light = lightness(fg_color)
    
    if abs(bg_light - fg_light) < threshold
        if bg_light < threshold
            fg_light = bg_light + threshold
        else
            fg_light = bg_light - threshold
    
    return lightness(fg_color, fg_light)


bg_color_regular = #252525
font_color_regular = #ccc
accent_color = #a34da3

@media (prefers-color-scheme: light)
    bg_color_regular = #fff
    font_color_regular = #000
    accent_color = #714a71

content_width = 40em


increments = 10%

bg_color_dark4 = darken(bg_color_regular, 4*increments)
bg_color_dark3 = darken(bg_color_regular, 3*increments)
bg_color_dark2 = darken(bg_color_regular, 2*increments)
bg_color_dark = darken(bg_color_regular, increments)
bg_color_light = lighten(bg_color_regular, increments)
bg_color_light2 = lighten(bg_color_regular, 2*increments)
    
font_color_dark = darken(font_color_regular, increments)
font_color_light = lighten(font_color_regular, increments)
font_color_light2 = lighten(font_color_regular, 2*increments)
        
font_color_placeholder = #aaa
        
info_bg = #506977
info_fg = font_color_light
warning_bg = #c8ba70
warning_fg = make_font_color_for_background(warning_bg)
        
border_color = accent_color

accent_color2 = darken(accent_color, 15%)
accent_font_color = make_font_color_for_background(accent_color)

accent_color_disabled = saturation(accent_color, 10%)
accent_font_color_disabled = darken(accent_font_color, 3*increments)


hover_effect()
    filter: brightness(1.1)


body
    background-color: bg_color_regular
    color: font_color_regular

a
    color: accent_color
a:hover
a:focus
    color: accent_color
    hover_effect()

details > summary
    background: accent_color
    color: accent_font_color
    padding: 0 0.2em

button
    background: accent_color

    &:hover 
        hover_effect()

input[type="text"]
textarea
.ace-github
select
    background: bg_color_dark !important
    border: 1px solid accent_color !important
    color: font_color_dark !important

input[type="text"]:focus
textarea:focus 
select:focus
    box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0.075), 0 0 8px rgba(196, 196, 196, 0.4)

::-webkit-input-placeholder
:-moz-placeholder
::-moz-placeholder
:-ms-input-placeholder
    color: font_color_placeholder

.ace-github
    .ace_gutter 
        background: bg_color_light
        color: font_color_dark
    
    .ace_marker-layer .ace_active-line 
        background: bg_color_light
    
    .ace_print-margin 
        background: bg_color_light
    
    .ace_cursor 
        color: accent_color


blockquote 
    border-left: 5px solid bg_color_light2


code
    color: mix(font_color_regular, accent_color, 75%)
    
    font-size: 1rem
    

pre 
    background: bg_color_dark2
    color: font_color_regular
    
    border: 1px solid border_color
    padding: 0.5em
    
    overflow: auto
    
    font-size: 0.9rem


// make inline code the same size as all other text
h1
    &
    code
        font-size: 2rem

h2
    &
    code
        font-size: 1.6rem

h3
    &
    code
        font-size: 1.3rem

// === END OF GENERIC DARK STYLE ===

// === SITE LAYOUT ===

// If there's enough space, the content will be centered
// and the navigation will be on the left
default_layout_width = content_width + 7em

@media (min-width: default_layout_width)
    body
        display: grid
        grid-template-columns: 1fr auto 1fr
        grid-column-gap: 2em
        
    #sidebar
        grid-row: 1 / 3
        grid-column: 1

    .document
        grid-row: 1
        grid-column: 2

        max-width: content_width
        margin: auto

    #bottomnav
        grid-row: 2
        grid-column: 2
        
        max-width: content_width

    #sidebar
        #sidebar-content
            float: right
            height: 100%

            a.homepage-link
                position: sticky
                top: 1.5em

// If there isn't enough space for the default layout,
// the navigation is moved to the top
@media not all and (min-width: default_layout_width)
    body
        display: grid
        grid-template-columns: auto

    #sidebar
        grid-row: 1
        grid-column: 1
    
    .document
        grid-row: 2
        grid-column: 1
    
    #bottomnav
        grid-row: 3
        grid-column: 1
    
    #sidebar
        #sidebar-content
            float: left

            a.homepage-link
                top: 1.5em


#bottomnav
    margin-top: 3em
    margin-bottom: 5em

    display: grid
    grid-template-columns: 1fr auto 1fr
    grid-column-gap: 40px
    
    align-items: baseline
    
    a.prev-link
        grid-row: 1
        grid-column: 1
        
        justify-self: start
    
    a.homepage-link
        grid-row: 1
        grid-column: 2
        
        justify-self: start
    
    a.next-link
        grid-row: 1
        grid-column: 3
        
        justify-self: end

// === END OF SITE LAYOUT ===

// reduce spacing between list items
li
    p:first-child
        margin-top: 0
    
    p:last-child
        margin-bottom: 0

li + li
    margin-top: 0.3em
    

// section permalinks
.toctree-wrapper a.headerlink
    display: none


// rubrics, usually used for footnotes
.rubric
    font-size: 1.3em
    margin-top: 2em


// footnote markers
.footnote-reference
    font-size: 0.6em
    text-align: start
    vertical-align: super
    

// footnote listing
dl.footnote
    display: grid
    grid-template-columns: max-content auto
    
    dt
        grid-column: 1
    
    
    dd
        grid-column: 2
        
        margin-left: 1em
        
        p
            margin-top: 0


// section headings
h1
    a.headerlink
        display: none

h2
h3
h4
h5
    a.headerlink
        margin-left: 0.3em
        text-decoration: none

    &:not(:hover)
        a.headerlink
            display: none

h1
    margin-bottom: 1.5em


// navigation links
a.homepage-link
a.prev-link
a.next-link
    text-decoration: none
    
    display: grid
    grid-column-gap: 0.2em
    
    span
        text-decoration: underline

a.homepage-link
    &::before
        content: "⌂"
        grid-column: 1
    
    span
        grid-column: 2

a.prev-link
    &::before
        content: "◁"
        grid-column: 1
    
    span
        grid-column: 2

a.next-link
    &::after
        content: "▷"
        grid-column: 2
    
    span
        grid-column: 1
